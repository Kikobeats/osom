<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="assets/style.css?t=90051322">
    <link rel="stylesheet" href="main.css?t=ea99e8f2">
    <link rel="stylesheet" href="style.css?t=d707d9da">
    <script src="assets/script.js?t=93f1a66c"></script>
    <title>osom</title>
    <meta name="viewport" content="width=device-width">
  </head>
  <body class="-menu-visible">
    <div class="doc-layout">
      <div class="toggle menu-toggle js-menu-toggle"></div>
      <div class="menu toc-menu">
        <ul>
          <li class="menu-item -level-0 -parent">
            <ul class="submenu">
              <li class="menu-item -level-1"><a class="link title -active link-index" href="index.html">osom</a>
              </li>
              <li class="menu-item -level-1"><a class="link title link-installation" href="#installation">Installation</a>
              </li>
              <li class="menu-item -level-1"><a class="link title link-preview" href="#preview">Preview</a>
              </li>
              <li class="menu-item -level-1"><a class="link title link-usage" href="#usage">Usage</a>
              </li>
              <li class="menu-item -level-1 -parent"><a class="link title link-schema" href="#schema">Schema</a>
                <ul class="submenu">
                  <li class="menu-item -level-2"><a class="link title link-simple" href="#simple">Simple</a>
                  </li>
                  <li class="menu-item -level-2"><a class="link title link-advanced" href="#advanced">Advanced</a>
                  </li>
                </ul>
              </li>
              <li class="menu-item -level-1 -parent"><a class="link title link-defining-rules" href="#defining-rules">Defining Rules</a>
                <ul class="submenu">
                  <li class="menu-item -level-2"><a class="link title link-type" href="#type">type</a>
                  </li>
                  <li class="menu-item -level-2"><a class="link title link-casting" href="#casting">casting</a>
                  </li>
                  <li class="menu-item -level-2"><a class="link title link-required" href="#required">required</a>
                  </li>
                  <li class="menu-item -level-2"><a class="link title link-default" href="#default">default</a>
                  </li>
                  <li class="menu-item -level-2"><a class="link title link-transform" href="#transform">transform</a>
                  </li>
                  <li class="menu-item -level-2"><a class="link title link-validate" href="#validate">validate</a>
                  </li>
                </ul>
              </li>
              <li class="menu-item -level-1"><a class="link title link-defining-global-rules" href="#defining-global-rules">Defining Global Rules</a>
              </li>
              <li class="menu-item -level-1 -parent"><a class="link title link-tips" href="#tips">Tips</a>
                <ul class="submenu">
                  <li class="menu-item -level-2"><a class="link title link-working-with-async-code" href="#working-with-async-code">Working with async code</a>
                  </li>
                </ul>
              </li>
              <li class="menu-item -level-1"><a class="link title link-license" href="#license">License</a>
              </li>
            </ul>
          </li>
        </ul>
      </div>
      <div class="body page-index">
        <div class="header-nav">
          <div class="right"><a class="iconlink" href="https://github.com/kikobeats/osom" data-title="kikobeats/osom">
              <!-- span.title Open in GitHub--><span class="icon -github"></span></a>
          </div>
        </div>
        <div class="markdown-body"><h1 class="massive-header -with-tagline" id="osom">osom</h1>
<blockquote>
<p>An Awesome [/osom/] Object Data Modeling. Inspired in <a href="https://github.com/Automattic/mongoose#defining-a-model">mongoose </a> but Database Agnostic.</p>
</blockquote>
<p><img src="https://img.shields.io/github/tag/Kikobeats/osom.svg?style=flat-square" alt="Last version">
<a href="https://coveralls.io/github/Kikobeats/osom"><img src="https://img.shields.io/coveralls/Kikobeats/osom.svg?style=flat-square" alt="Coverage Status"></a>
<a href="https://www.npmjs.org/package/osom"><img src="https://img.shields.io/npm/dm/osom.svg?style=flat-square" alt="NPM Status"></a></p>
<h2 id="installation">Installation</h2>
<pre><code class="lang-bash">$ npm install osom --save
</code></pre>
<h2 id="preview">Preview</h2>
<pre><code class="lang-js"><span class="pl-k">const</span> osom = <span class="pl-c1">require</span>(<span class="pl-s">&apos;osom&apos;</span>)

<span class="hljs-function"><span class="pl-k">function</span> <span class="pl-ent">trim</span> (<span class="hljs-params">str</span>) </span>{
  <span class="pl-k">return</span> str.trim()
}

<span class="hljs-function"><span class="pl-k">function</span> <span class="pl-ent">isValidTitle</span> (<span class="hljs-params">str</span>) </span>{
  <span class="pl-k">return</span> str.length &gt; <span class="hljs-number">0</span>
}

<span class="pl-c">// setup your schema</span>
<span class="pl-k">const</span> schema = {
  <span class="hljs-attr">title</span>: {
    <span class="hljs-attr">type</span>: <span class="pl-c1">String</span>,
    <span class="hljs-attr">validate</span>: isValidTitle,
    <span class="hljs-attr">transform</span>: [trim]
  },
  <span class="hljs-attr">category</span>: <span class="pl-c1">String</span>,
  <span class="hljs-attr">type</span>: <span class="pl-c1">String</span>,
  <span class="hljs-attr">source</span>: <span class="pl-c1">String</span>,
  <span class="hljs-attr">link</span>: <span class="pl-c1">String</span>,
  <span class="hljs-attr">createdAt</span>: <span class="pl-c1">String</span>,
  <span class="hljs-attr">updatedAt</span>: <span class="pl-c1">String</span>
}

<span class="pl-c">// create validator based on schemas</span>
<span class="pl-k">const</span> validator = osom(schema)

<span class="pl-c">// validate it!</span>
validator({ <span class="hljs-attr">title</span>: <span class="pl-s">&apos;  23  &apos;</span> }) <span class="pl-c">// =&gt; {title: &apos;23&apos;}</span>
</code></pre>
<h2 id="usage">Usage</h2>
<p class="font-large">osom(schema, [global])</p>
<p>where:</p>
<ul>
<li><code>schema</code>: It represents a set of rules (one per each key) that will be used for validate an object.</li>
<li><code>global</code> (optional): It brings you the possibility to declare global rules definition as helper to avoid write repetitive code.</li>
</ul>
<p>After that, you will have a validator <code>function</code> that you can invoke passing the object to be validate.</p>
<h2 id="schema">Schema</h2>
<h3 id="simple">Simple</h3>
<p>The most common use case is validate the <code>type</code> of something.</p>
<p>If you are only interested in the <code>type</code>, you can provide a simple schema like:</p>
<pre><code class="lang-js"><span class="pl-k">const</span> simpleSchema = {
  <span class="hljs-attr">age</span>: <span class="pl-c1">Number</span>
}
</code></pre>
<p>Where <code>key</code> is the name of the rule and <code>value</code> the <code>type</code> of it.</p>
<h3 id="advanced">Advanced</h3>
<p>The <em>basic</em> mode is a simplification of the <em>advanced</em> mode for the most common use case.</p>
<p>While in <em>basic</em> mode only is possible setup <code>type</code>, in <em>advanced</em> mode you can setup more things providing a configurable <code>object</code>.</p>
<p>Each key of the object represent a <strong>rule</strong> . It&#x2019;s possible setup different things in the same rule.</p>
<h2 id="defining-rules">Defining Rules</h2>
<h3 id="type">type</h3>
<p>Type: <code>function</code></p>
<p>As in <em>basic</em> mode, it specifies the <code>type</code> of the output value:</p>
<pre><code class="lang-js"><span class="pl-k">const</span> schema = {
  <span class="hljs-attr">age</span>: {
    <span class="hljs-attr">type</span>: <span class="pl-c1">Number</span>
  }
}
</code></pre>
<p>Internally it uses <a href="https://github.com/Kikobeats/chaste">chaste</a>. This makes easy casting compatible types:</p>
<pre><code class="lang-js"><span class="pl-k">const</span> schema = {
  <span class="hljs-attr">age</span>: {
    <span class="hljs-attr">type</span>: <span class="pl-c1">Number</span>
  }
}

<span class="pl-k">const</span> validator = osom(schema)
validator({ <span class="hljs-attr">age</span>: <span class="pl-s">&apos;23&apos;</span> }) <span class="pl-c">// =&gt; {age: 23}</span>
</code></pre>
<h3 id="casting">casting</h3>
<p>Type: <code>boolean</code><br>
Default: <code>true</code></p>
<p>It enable/disable type casting.
An <code>TypeError</code> will be throwed under different <code>type</code> evaluation.</p>
<pre><code class="lang-js"><span class="pl-k">const</span> schema = {
  <span class="hljs-attr">age</span>: {
    <span class="hljs-attr">type</span>: <span class="pl-c1">String</span>,
    <span class="hljs-attr">casting</span>: <span class="pl-c1">false</span>
  }
}

<span class="pl-k">const</span> validator = osom(schema)
validator({ <span class="hljs-attr">age</span>: <span class="pl-s">&apos;23&apos;</span> }) <span class="pl-c">// =&gt; TypeError(&quot;Expected a {string} for &apos;age&apos;.&quot;)</span>
</code></pre>
<h3 id="required">required</h3>
<p>Type: <code>boolean</code>|<code>string</code><br>
Default: <code>false</code></p>
<p>It marks a rule as required field and throws <code>TypeError</code> if value for the field is not present.</p>
<p>Additionally is possible provide a custom error message. For do it, pass an <code>String</code>.</p>
<pre><code class="lang-js"><span class="pl-k">const</span> schema = {
  <span class="hljs-attr">age</span>: {
    <span class="hljs-attr">type</span>: <span class="pl-c1">String</span>,
    <span class="hljs-attr">required</span>: <span class="pl-s">&apos;sorry but you must provide an age.&apos;</span>
  }
}

<span class="pl-k">const</span> validator = osom(schema)
validator({}) <span class="pl-c">// =&gt; TypeError(&quot;sorry but you must provide an age&quot;)</span>
</code></pre>
<h3 id="default">default</h3>
<p>Type: <code>string</code>|<code>object</code>|<code>number</code>|<code>boolean</code>|<code>function</code><br>
Default: <code>null</code></p>
<p>It sets a default value if <code>nill</code> value as input is provided.</p>
<p>Additionally you can provide a <code>function</code> for set a dynamic value:</p>
<pre><code class="lang-js"><span class="pl-k">const</span> schema = {
  <span class="hljs-attr">age</span>: {
    <span class="hljs-attr">type</span>: <span class="pl-c1">Number</span>, <span class="hljs-attr">default</span>: <span class="hljs-function"><span class="pl-k">function</span> (<span class="hljs-params"></span>) </span>{ <span class="pl-k">return</span> <span class="hljs-number">23</span> }
  }
}

<span class="pl-k">const</span> validator = osom(schema)
validator({}) <span class="pl-c">// =&gt; { age: 23 }</span>
</code></pre>
<h3 id="transform">transform</h3>
<p>Type: <code>function</code>|<code>array</code><br>
Default: <code>[]</code></p>
<p>It transforms the input value.</p>
<p>The Methods provided in the <code>array</code> are applied as pipeline (the input of the second is the output of the first).</p>
<pre><code class="lang-js"><span class="hljs-function"><span class="pl-k">function</span> <span class="pl-ent">trim</span> (<span class="hljs-params">str</span>) </span>{
  <span class="pl-k">return</span> str.trim()
}

<span class="pl-k">const</span> schema = {
  <span class="hljs-attr">age</span>: {
    <span class="hljs-attr">type</span>: <span class="pl-c1">String</span>,
    <span class="hljs-attr">transform</span>: [trim]
  }
}

<span class="pl-k">const</span> validator = osom(schema)
validator({ <span class="hljs-attr">age</span>: <span class="pl-s">&apos;    23   &apos;</span> }) <span class="pl-c">// =&gt; { age: &apos;23&apos; }</span>
</code></pre>
<h3 id="validate">validate</h3>
<p>Type: <code>function</code>|<code>object</code><br>
Default: <code>null</code></p>
<p>It set up a <code>function</code> that will be exec to validate the input value.
If it fails, it throws <code>TypeError</code>.</p>
<pre><code class="lang-js"><span class="pl-k">const</span> schema = {
  <span class="hljs-attr">age</span>: {
    <span class="hljs-attr">type</span>: <span class="pl-c1">String</span>,
    <span class="hljs-attr">validate</span>: <span class="hljs-function"><span class="pl-k">function</span> (<span class="hljs-params">v</span>) </span>{
      <span class="pl-k">return</span> v === <span class="pl-s">&apos;23&apos;</span>
    }
  }
}

<span class="pl-k">const</span> validator = osom(schema)
validator({ <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> }) <span class="pl-c">// =&gt; TypeError(&quot;Fail &apos;25&apos; validation for &apos;age&apos;.&quot;)</span>
</code></pre>
<p>Providing a object brings you the possibility set up a custom error message:</p>
<pre><code class="lang-js"><span class="pl-k">const</span> schema = {
  <span class="hljs-attr">age</span>: {
    <span class="hljs-attr">type</span>: <span class="pl-c1">String</span>,
    <span class="hljs-attr">validate</span>: {
      <span class="hljs-attr">validator</span>: <span class="hljs-function"><span class="pl-k">function</span> (<span class="hljs-params">v</span>) </span>{
        <span class="pl-k">return</span> v === <span class="pl-s">&apos;23&apos;</span>
      },
      <span class="hljs-attr">message</span>: <span class="pl-s">&apos;expected a millenial value instead of %s!&apos;</span>
    }
  }
}

<span class="pl-k">const</span> validator = osom(schema)
validator({ <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> }) <span class="pl-c">// =&gt; TypeError(&quot;expected a millenial value instead of 25!&quot;)</span>
</code></pre>
<h2 id="defining-global-rules">Defining Global Rules</h2>
<p>While is possible provide specific setup per each rule, also is possible provide them as global to apply to all rules.</p>
<p>This minimizes the schemas definitions.</p>
<pre><code class="lang-js"><span class="hljs-function"><span class="pl-k">function</span> <span class="pl-ent">trim</span> (<span class="hljs-params">str</span>) </span>{
  <span class="pl-k">return</span> str.trim()
}

<span class="pl-k">const</span> schema = {
  <span class="hljs-attr">age</span>: {
    <span class="hljs-attr">type</span>: <span class="pl-c1">String</span>
  }
}

<span class="pl-k">const</span> globalFields = {
  <span class="hljs-attr">transform</span>: [trim]
}

<span class="pl-k">const</span> validator = osom(schema, globalFields)
validator({ <span class="hljs-attr">age</span>: <span class="pl-s">&apos;  23  &apos;</span> }) <span class="pl-c">// =&gt; {age: &apos;23&apos;}</span>
</code></pre>
<p>No problem if later you need to avoid it for a specific case.</p>
<pre><code class="lang-js"><span class="hljs-function"><span class="pl-k">function</span> <span class="pl-ent">trim</span> (<span class="hljs-params">str</span>) </span>{
  <span class="pl-k">return</span> str.trim()
}

<span class="pl-k">const</span> schema = {
  <span class="hljs-attr">age</span>: {
    <span class="hljs-attr">type</span>: <span class="pl-c1">String</span>,
    <span class="hljs-attr">transform</span>: []
  }
}

<span class="pl-k">const</span> globalFields = {
  <span class="hljs-attr">transform</span>: [trim]
}

<span class="pl-k">const</span> validator = osom(schema, globalFields)
validator({ <span class="hljs-attr">age</span>: <span class="pl-s">&apos;  23  &apos;</span> }) <span class="pl-c">// =&gt; {age: &apos;  23  &apos;}</span>
</code></pre>
<h2 id="tips">Tips</h2>
<h3 id="working-with-async-code">Working with async code</h3>
<p>This library works synchronously.</p>
<p>However, you can use it comfortably in a async workflow transforming the interface into a callback/promise style.</p>
<p>For example, consider use <a href="https://github.com/caolan/async#asyncify">async#asyncify</a> for do it. we could have a <code>schema.js</code> file like:</p>
<pre><code class="lang-js"><span class="pl-k">const</span> schema = osom({
  <span class="hljs-attr">title</span>: {
    <span class="hljs-attr">type</span>: <span class="pl-c1">String</span>,
    <span class="hljs-attr">validate</span>: isValidTitle,
    <span class="hljs-attr">transform</span>: [trim]
  },
  <span class="hljs-attr">category</span>: <span class="pl-c1">String</span>,
  <span class="hljs-attr">type</span>: <span class="pl-c1">String</span>,
  <span class="hljs-attr">source</span>: <span class="pl-c1">String</span>,
  <span class="hljs-attr">link</span>: <span class="pl-c1">String</span>,
  <span class="hljs-attr">createdAt</span>: <span class="pl-c1">String</span>,
  <span class="hljs-attr">updatedAt</span>: <span class="pl-c1">String</span>
})

<span class="pl-c1">module</span>.exports = <span class="pl-k">async</span>.asyncify(schema)
<span class="pl-c1">module</span>.exports.sync = schema
</code></pre>
<p>Then you only need use it into a async workflow:</p>
<pre><code class="lang-js"><span class="pl-k">const</span> schema = <span class="pl-c1">require</span>(<span class="pl-s">&apos;./schema&apos;</span>)
schema(data, <span class="hljs-function"><span class="pl-k">function</span> (<span class="hljs-params">validationError, instance</span>) </span>{
  <span class="pl-c">/** do something */</span>
})
</code></pre>
<p>Be careful: this transformation doesn&#x2019;t mean that the function works now asynchronously; Just is converting
<code>try-catch</code> interface into <code>callback(err, data)</code>.</p>
<h2 id="license">License</h2>
<p>MIT &#xA9; <a href="https://kikobeats.com">Kiko Beats</a></p>

        </div>
      </div>
    </div>
  </body>
</html>